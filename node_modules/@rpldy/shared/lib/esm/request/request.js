var setHeaders = function (req, headers) {
  if (headers) {
    Object.keys(headers).forEach(function (name) {
      if (headers[name] !== undefined) {
        req.setRequestHeader(name, headers[name]);
      }
    });
  }
};

var request = function (url, data) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var req = new XMLHttpRequest();
  var pXhr = new Promise(function (resolve, reject) {
    req.onerror = function () {
      return reject(req);
    };

    req.ontimeout = function () {
      return reject(req);
    };

    req.onabort = function () {
      return reject(req);
    };

    req.onload = function () {
      return resolve(req);
    };

    req.open(options.method || "GET", url);
    setHeaders(req, options.headers);
    req.withCredentials = !!options.withCredentials;

    if (options.preSend) {
      options.preSend(req);
    }

    req.send(data);
  }); // $FlowFixMe - adding xhr to Promise

  pXhr.xhr = req;
  return pXhr;
};

export default request;